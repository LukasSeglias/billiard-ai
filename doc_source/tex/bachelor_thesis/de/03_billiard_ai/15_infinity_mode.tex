\section{Infinity-Modus}
Der Infinity-Modus soll es dem Spieler ermöglichen, einen Vorschlag für einen Stoss zu erhalten,
einen Stoss auszuführen und anschliessend auf Basis des dadurch entstandenen Spielstandes einen neuen Vorschlag zu erhalten.

Dies bedingt die Klassifikation des Spielstandes in stabil und instabil.
Ein Spielstand ist instabil, sofern sich noch Kugeln bewegen oder der Spieler gerade dabei ist, einen Stoss durchzuführen.
Der Spielstand gilt als stabil, wenn die Kugeln stehen bleiben.
Sofern sich der Spielstand zu stabil ändert, wird eine Suche nach dem optimalen Stoss ausgeführt,
und das Resultat wird dem Spieler auf dem Tisch angezeigt.
Währenddessen, dass der Spielstand instabil ist, soll keine erneute Suche ausgelöst werden,
damit der Spieler die Chance hat, den Vorschlag zu prüfen und gemäss angezeigter Animation auszuführen.

Die Detektion des aktuellen Spielstandes enthält über die Zeit betrachtet ein gewisses zufälliges Rauschen.
Dadurch verändern sich die Positionen aller Kugeln auch bei komplettem Stillstand leicht.
Ausserdem werden manchmal Kugeln erkannt wo keine Kugeln liegen, oder es werden Kugeln nicht erkannt.
Dieser Ungewissheit muss Rechnung getragen werden, wobei der Modus hierzu auf dem in Abschnitt \ref{kap:tracking}
beschriebenen Tracking und der Positionsstabilisierung aufbaut.

Die Bedingungen, dass der Spielstand als stabil gilt, sind nachfolgend aufgeführt und werden in den nächsten Abschnitten erläutert.
\begin{enumerate}
    \item Tracking des Spielballs: Der Spielball wurde gefunden.
    \item Bewegungserkennung: Keine Kugel ist als \emph{bewegt} eingestuft.
    \item Verlust von Kugeln: Keine Kugel ging seit der letzten Detektion des Spielstandes verloren.
    \item Neue Kugeln: Es ist keine Kugel zum Spielstand hinzugefügt worden.
    \item Robustheit: Die aktuelle Anzahl detektierter Kugeln entspricht der Anzahl über längere Zeit getrackter Kugeln.
    \item Zeitliche Stabilität: Der Spielstand muss konsequent über einige Frames als stabil eingestuft werden.
\end{enumerate}

\subsection{Tracking des Spielballs}
Der Spielball ist von allen Kugeln einzigartig, weil in einem regelkonformen Spiel höchstens ein Spielball auf dem Tisch liegt.
Diese Erkenntnis kann daher ausgenutzt werden, um diesen wiederzufinden.
Sollte der Spielball nicht auf dem Tisch liegen, weil er beispielsweise eingelocht wurde, verändert sich der Spielstand auf den Status instabil.

Die in Abschnitt \ref{kap:detektion} beschriebene Detektion führt manchmal zu fälschlich erkannten Kugeln.
So kann es passieren, dass mehrere weisse Kugeln auf dem Tisch erkannt werden.
Daher muss der echte Spielball gefunden werden.

Im Fall, dass eine einzige weisse Kugel erkannt wurde, wird diese als Spielball angenommen.
Sofern es mehrere weisse Kugeln gibt, wird diejenige gesucht, welche der zuletzt bekannten Position des Spielballs am nächsten ist.
Falls sich diese Kugel nicht zu weit entfernt befindet, dann wird sie als Spielball angenommen und die
anderen weissen Kugeln werden ignoriert.
Falls keine naheliegende Kugel gefunden wurde, wird angenommen, dass der Spielball nicht auf dem Tisch liegt.
Das Gleiche passiert, sofern keine weisse Kugel erkannt wurde.

\subsection{Bewegungserkennung}
Der Spielstand darf erst als stabil gelten, wenn keine Kugeln mehr in Bewegung sind.
Da alle Kugeln bereits getrackt werden, kann für jede erfolgreich getrackte Kugel eine History analog derjenigen für die
Kugelpositionen aus Abschnitt \ref{kap:tracking} geführt werden.
So wird für jede getrackte Kugel die Bewegung der detektierten Kugelposition zwischen zwei aufeinanderfolgenden Frames
über $M$ Frames gespeichert.
Mithilfe dieser Bewegungsvektoren wird anschliessend ein Mittelwert gebildet, um den durchschnittlichen Bewegungsvektor über
die letzten $M$ Frames zu erhalten.
Der Betrag dieses Vektors kann anschliessend genutzt werden, um einzuschätzen, ob die Kugel in Bewegung ist oder nicht.
Wenn eine Kugel in Bewegung versetzt wird, steigt dieser Durchschnitt zunächst und sinkt wieder, sobald die Kugel ausrollt.
Eine Kugel gilt als bewegt, wenn der Betrag des durchschnittlichen Bewegungsvektors über dem Grenzwert von $0.5mm$ liegt.

\subsection{Verlust von Kugeln}
Sofern eine Kugel eingelocht wird, verändert sich die Gesamtanzahl der Kugeln und der Spielstand ist für eine kurze Zeit instabil.
Es reicht allerdings nicht aus, die Anzahl detektierter Kugeln zweier aufeinanderfolgender Frames zu vergleichen,
da Detektionsfehler diesen Vergleich verfälschen können.
Wenn beispielsweise in Frame $F_{t-1}$ eine Kugel zu viel detektiert und diese Kugel in Frame $F_{t}$ nicht mehr
detektiert wird, dann würde diese Kugel in Frame $F_{t}$ als verloren eingestuft.
Da diese Detektionsfehler oft nur auf einzelnen Frames auftauchen, gilt eine Kugel erst als verloren, wenn diese zuvor
$O$ Frames erfolgreich getrackt werden konnte.

\subsection{Neue Kugeln}
Sofern eine Kugel auf dem Tisch platziert wird, verändert diese Anpassung den Spielstand zu instabil.
Sobald die neue Kugel folgedessen eine bestimmte Zeit lang auf dem Tisch liegt und nicht mehr als \emph{neu} gilt,
wechselt der Spielstand wieder zu stabil.
Damit auch hier fälschlich detektierte Kugeln nicht zu Fehlentscheidungen führen, werden hierzu nur Kugeln
betrachtet, welche $N$ Frames lang erfolgreich getrackt wurden.
Anschliessend kann die Anzahl der in Frame $F_{t}$ erfolgreich getrackten Kugeln mit derjenigen aus Frame $F_{t-1}$
verglichen werden.
Sofern diese Differenz positiv ist, wurden Kugeln dem Spielstand hinzugefügt und der Spielstand folglich als instabil markiert.

\subsection{Robustheit}
Damit Detektionsfehler nicht in der Suche nach Stössen berücksichtigt werden, muss der Spielstand als instabil gelten,
solange sich fälschlich detektierte Kugeln auf dem Tisch befinden.
Daher muss die Anzahl aktuell detektierter Kugeln mit der Anzahl Kugeln übereinstimmen, welche über $N$ Frames erfolgreich
getrackt wurden.
So ist sichergestellt, dass der Spielstand erst stabil wird, wenn alle tatsächlich vorhandenen Kugeln lange genug
getrackt wurden und keine Fehldetektionen vorhanden sind.

\subsection{Zeitliche Stabilität}
Der Wechsel zum Status stabil sollte möglichst nur dann auftreten, wenn der Spielstand vollkommen ruhig ist.
Ausserdem darf es nicht passieren, dass der Status zu volatil ist.
Es wäre problematisch, wenn der Status innerhalb weniger Frames mehrfach zwischen stabil und instabil wechseln würde,
denn bei jedem Wechsel zum Status stabil wird eine Suche ausgelöst und dem Spieler ein Vorschlag angezeigt.
Würde der Status während der Ausführung des Stosses von instabil zu stabil ändern, hätte das eine erneute Suche zur Folge
und der bisherige Vorschlag würde nicht mehr angezeigt, bis der Neue erscheint.
Daher wird der Status erst tatsächlich als stabil ausgewiesen, wenn er über mindestens $P$ Frames als stabil erkannt wurde.

Die oben beschriebenen Bedingungen dienen dem Ziel des Infinity-Modus, dem Spieler zu geeigneter Zeit
einen Vorschlag für einen Stoss zu berechnen und anzuzeigen, bis der Spieler diesen ausgeführt hat
und folglich ein neuer Vorschlag erwartet wird.
